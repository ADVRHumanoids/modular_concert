<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />

<script src="https://static.robotwebtools.org/threejs/current/three.js"></script>
<script src="https://static.robotwebtools.org/threejs/current/ColladaLoader.js"></script>
<script src="https://static.robotwebtools.org/threejs/current/STLLoader.js"></script>
<script src="https://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
<script src="https://static.robotwebtools.org/roslibjs/current/roslib.js"></script>
<script src="../build/ros3d.js"></script>
<script src="js/ColladaLoader.js"></script> <!-- override the default ColladaLoader -->

<script src="../build/jointstatepublisher.js"></script>
<script src="js/three.js"></script>



<script>
  /**
   * Setup all visualization elements when the page is loaded.
   */
  function init() {
    // Connect to ROS.
    var ros = new ROSLIB.Ros({
      url : 'ws://localhost:9090'
    });

    // Create the main viewer.
    var viewer = new ROS3D.Viewer({
      divID : 'urdf',
      width : 700,
      height : 525,
      antialias : true
    });

    // Add a grid.
    viewer.addObject(new ROS3D.Grid());

    // Setup a client to listen to TFs.
    var tfClient = new ROSLIB.TFClient({
      ros : ros,
      angularThres : 0.01,
      transThres : 0.01,
      rate : 10.0
    });

    // Setup the URDF client.
    var urdfClient = new ROS3D.UrdfClient({
      ros : ros,
      tfClient : tfClient,
      // param : '$(find modular)/urdf/ModularBot_test.urdf',
      path : 'http://resources.robotwebtools.org/',
      rootObject : viewer.scene,
    });

    var jsp = new JOINTSTATEPUBLISHER.JointStatePublisher({
      ros : ros,
      divID : 'sliders'
    });

    
  }
</script>
</head>

<body onload="init()">
  <h1>URDF Generator</h1>
  <p>Run the following commands in the terminal then refresh this page.</p>
  <ol>
    <li><tt>roslaunch modular modular.launch model:='$(find modular)/urdf/ModularBot_test.urdf'</tt></li>
    <li><tt>roslaunch joint_state_publisher_js core.launch</tt></li>
    <li><tt>roslaunch rosbridge_server rosbridge_websocket.launch</tt></li>
    <li><tt>python path/to/modular/web/URDF_generator_elbow.py</tt></li>
  </ol>
  <form method="post" id="form">
    <label for="mod_name">Enter Module : </label>
    <input type="text" id="mod_name" name="module_name" autofocus autocomplete="off">
    <button>Post</button>
  </form>
  <div id="urdf"><p id="square"></p></div>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script>
    $('#form').on('submit', function(e){
      var module_name = $('#mod_name').val();
      e.preventDefault();
      $.ajax({
        url: 'http://127.0.0.1:5000/square/',
        data: {'module_name': module_name},
        method: 'POST',
        success: function(data) {
          $('#mod_name').val('');
          $('#square').html(data['result'])
          // urdfClient
          // urdfClient = new ROS3D.UrdfClient({
          //   ros : ros,
          //   tfClient : tfClient,
          //   // param : '$(find modular)/urdf/ModularBot_test.urdf',
          //   path : 'http://resources.robotwebtools.org/',
          //   rootObject : viewer.scene,
          // })
        },
        async: false
      });
      $('#mod_name').val('');
      $('#square').html(data['result']);
      urdfClient = new ROS3D.UrdfClient({
        ros : ros,
        tfClient : tfClient,
        // param : '$(find modular)/urdf/ModularBot_test.urdf',
        path : 'http://resources.robotwebtools.org/',
        rootObject : viewer.scene,
      })
    });
  </script>
  <div id="urdf"></div>
  <div id="sliders" style="float: right"></div>
  <!-- <div id="container"></div> -->
</body>

</html>

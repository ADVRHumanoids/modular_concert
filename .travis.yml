os: linux
language: python
dist: bionic

branches:
  only:
    - python3
    - /^v\d+\.\d+\.\d+.*$/ # version tags

notifications:
  email:
    recipients:
      - edoardo.romiti@iit.it
      - arturo.laurenzi@iit.it
    on_success: never
    on_failure: always

install:
  - echo "Travis tag is $TRAVIS_TAG"
  - python --varsion
  - pip --version
  - pip install pyinstaller
  - pip install -e .

script:
  - cd src/modular/web/
  - pyinstaller --onefile RobotBuilder.spec
  - ls dist/RobotBuilder # fail if does not exist

deploy:
  provider: releases
  api_key: $GH_TOKEN
  file: dist/RobotBuilder
  skip_cleanup: true
  on:
    tags: true

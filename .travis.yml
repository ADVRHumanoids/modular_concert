os: linux
language: python
compiler: g++
dist: bionic

branches:
  only:
    - python3
    - /^v\d+\.\d+\.\d+.*$/ # version tags

notifications:
  email:
    recipients:
      - edoardo.romiti@iit.it
      - arturo.laurenzi@iit.it
    on_success: never
    on_failure: always

before_script:
  - echo "Travis tag is $TRAVIS_TAG"
  - sudo pip install pyinstaller>3.6

script:
  - pip install -e .
  - cd src/modular/web/
  - pyinstaller --onefile RobotBuilder.spec
  - ls dist/RobotBuilder # fail if does not exist

deploy:
  provider: releases
  api_key: $GH_TOKEN
  file: dist/RobotBuilder
  skip_cleanup: true
  on:
    tags: true
